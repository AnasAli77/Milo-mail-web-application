@startuml
' A4 Portrait - Clean Beautiful Theme
!theme plain
skinparam backgroundColor #FEFEFE
skinparam defaultFontName Arial
skinparam defaultFontSize 10
skinparam roundCorner 8
skinparam shadowing false
skinparam sequenceMessageAlign center
skinparam participantPadding 10
scale max 700 width

skinparam participant {
    BackgroundColor #F8F9FA
    BorderColor #6C757D
}

skinparam note {
    BackgroundColor #FFF9C4
    BorderColor #FBC02D
    FontSize 9
}

title <size:14><b>Authentication Flow</b></size>

actor User #E3F2FD
participant "Frontend" as FE #E8F5E9
participant "Interceptor" as INT #FFF3E0
participant "Filter" as JF #FFF3E0
participant "Controller" as AC #E3F2FD
participant "Service" as AS #E3F2FD
participant "JWT" as JS #E3F2FD
participant "SecurityChain" as Chain #FFF3E0
database "DB" as DB #FCE4EC

== Login ==

User -> FE : Credentials
activate FE #E8F5E9

FE -> AC : POST /login
activate AC #E3F2FD

AC -> AS : verify()
activate AS #E3F2FD

AS -> DB : findUser()
activate DB #FCE4EC
DB --> AS : User
deactivate DB

AS -> JS : generateToken()
activate JS #E3F2FD
JS --> AS : token
deactivate JS

AS --> AC : User + Token
deactivate AS

AC --> FE : Response
deactivate AC

FE -> FE : Save Token
FE --> User : Redirect
deactivate FE

== Authenticated Request ==

User -> FE : View Inbox
activate FE #E8F5E9

note right of INT #FFF3E0: **Interceptor**
FE -> INT : Request
activate INT #FFF3E0
INT -> INT : Add Token
INT -> JF : GET /inbox
deactivate INT
activate JF #FFF3E0

note right of JF #FFF3E0: **Chain of Resp.**
JF -> JS : validate()
activate JS #E3F2FD
JS --> JF : valid
deactivate JS

alt Valid
    JF -> Chain : doFilter()
    activate Chain #FFF3E0
    Chain --> JF : Response
    deactivate Chain
    JF -> FE : 200 OK
else Invalid
    JF -> FE : 401 Unauthorized
end

deactivate JF
FE --> User : Display
deactivate FE

@enduml
