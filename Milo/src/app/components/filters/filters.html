<div class="filters-wrapper">

  <div class="filters-sidebar">
    <div class="sidebar-header">
      <h2>Filters</h2>
      <button class="add-btn" (click)="toggleCreateForm()" title="Create New Filter">
        <span>+</span>
      </button>
    </div>

    <div class="sidebar-list">
      @if (filters().length === 0) {
      <div class="empty-list-msg">No filters yet.</div>
      }
      @else {
      @for (filter of filters(); track filter.id) {
      <div class="list-item" [class.active]="selectedFilter() === filter" (click)="selectFilter(filter)">

        <div class="item-content">
          <div class="item-title">
            @if(filter.sender) { From: {{filter.sender}} }
            @else if(filter.subject) { Subject: {{filter.subject}} }
            @else { Complex Filter }
          </div>
          <div class="item-details">
            @if(filter.moveToFolderId) { <span>Move to {{filter.moveToFolderId}}</span> }
            @if(filter.star) { <span>Starred</span> }
          </div>
        </div>

        <button class="delete-icon" (click)="$event.stopPropagation(); deleteFilter(filter.id ?? 0)">
          <i class="fa fa-trash"></i>
        </button>
      </div>
      }
      }
    </div>
  </div>

  <div class="filters-content">

    @if (!isSearchFilterOpen() && !selectedFilter()) {
    <div class="content-empty-state">
      <i class="fa fa-filter huge-icon"></i>
      <h3>Select a filter or create a new one</h3>
    </div>
    }

    @if (isSearchFilterOpen() || selectedFilter()) {
    <div class="form-scroll-wrapper">
      <div class="form-header-row">
        <h2>{{ selectedFilter() ? 'Edit Filter' : 'New Filter' }}</h2>
        <button class="close-text-btn" (click)="clearFilter()">Close</button>
      </div>

      <form [formGroup]="filterForm" class="clean-form">

        <div class="form-group">
          <label>From</label>
          <input type="text" formControlName="searchFrom" placeholder="Sender">
        </div>
        <div class="form-group">
          <label>To</label>
          <input type="text" formControlName="searchTo" placeholder="Recipient">
        </div>
        <div class="form-group">
          <label>Subject</label>
          <input type="text" formControlName="searchSubject" placeholder="Subject">
        </div>
        <div class="form-group">
          <label>Has words</label>
          <input type="text" formControlName="searchQuery" placeholder="Words">
        </div>

        <div class="form-group">
          <label>Priority</label>
          <select formControlName="searchPriority">
            <option value="">Any</option>
            <option value="5">Extreme</option>
            <option value="4">High</option>
            <option value="3">Normal</option>
            <option value="2">Low</option>
            <option value="1">Very Low</option>
          </select>
        </div>

        <div class="form-group">
          <label>Date</label>
          <div class="date-row-inputs">
            <input type="text" formControlName="searchDay" placeholder="DD" maxlength="2">
            <input type="text" formControlName="searchMonth" placeholder="MM" maxlength="2">
            <input type="text" formControlName="searchYear" placeholder="YYYY" maxlength="4" class="year">
          </div>
        </div>

        <div class="form-group check-group">
          <div class="spacer"></div> <input type="checkbox" id="hasAttach" formControlName="searchHasAttachment">
          <label for="hasAttach" class="check-label">Has attachment</label>
        </div>

        <div class="section-divider">Actions</div>

        <div class="form-group">
          <label>Move to</label>
          <select formControlName="actionMoveToFolderId">
            <option value="">Choose folder...</option>
            @for (f of folders(); track $index) {
            <option [value]="f">{{ f }}</option>
            }
          </select>
        </div>

        <div class="form-group check-group">
          <div class="spacer"></div>
          <div class="checks-inline">
            <div>
              <input type="checkbox" id="actStar" formControlName="actionStar">
              <label for="actStar" class="check-label">Star it</label>
            </div>
            <div>
              <input type="checkbox" id="actRead" formControlName="actionMarkAsRead">
              <label for="actRead" class="check-label">Mark as read</label>
            </div>
          </div>
        </div>

        <div class="form-actions-row">
          @if (isSearchFilterOpen()) {
          <button type="button" class="btn-cancel" (click)="clearFilter()">Cancel</button>
          <button type="button" class="btn-save" (click)="onAdvancedSearch()">Create Filter</button>
          }
          @if (selectedFilter()) {
          <button type="button" class="btn-delete-text" (click)="deleteFilter(selectedFilter()?.id || 0)">Delete
            Filter</button>
          }
        </div>

      </form>
    </div>
    }
  </div>
</div>